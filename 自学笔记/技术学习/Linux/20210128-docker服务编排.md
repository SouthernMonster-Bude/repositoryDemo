### docker服务编排

服务编排（按照一定业务规则批量管理容器）

微服务架构的应用系统中一般包含若干个微服务，每个微服务一般都会部署多个实例，如果每个微服务都要手动启停，维护工作量很大

```text
要从dockerfile build image或者从dockerhub 拉取image
要创建多个container
要管理这些container

```

### docker compose

一个编排多容器分布式部署的工具，提供命令集管理容器化应用的完整开发周期，包括服务构建，启动和停止。

```text
利用dockerfile定义运行环境镜像
使用docker-compose.yml定义组成应用的个服务
运行docker-compose up 启动应用

```

### 安装

```shell
# Compose目前已经完全支持Linux、Mac OS和Windows，在我们安装Compose之前，需要先安装Docker。下面我 们以编译好的二进制包方式安装在Linux系统中。 
curl -L https://github.com/docker/compose/releases/download/1.22.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
# 设置文件可执行权限 
chmod +x /usr/local/bin/docker-compose
# 查看版本信息 
docker-compose -version
# 卸载方式
# 二进制包方式安装的，删除二进制文件即可
rm /usr/local/bin/docker-compose
```

### 三、 使用docker compose编排nginx+springboot项目

1. 创建docker-compose目录

```shell
mkdir ~/docker-compose
cd ~/docker-compose
```

2. 编写 docker-compose.yml 文件

```yml
version: '3'
services:
  nginx:
   image: nginx
   ports:
    - 88:80
   links:
    - app
   volumes:
    - ./nginx/conf.d:/etc/nginx/conf.d
  app:
    image: springbootapp:1
    ports:
      - 8083:8083
    expose:
      - "8083"
```

3. 创建./nginx/conf.d目录

```shell
mkdir -p ./nginx/conf.d
```

4. 在./nginx/conf.d目录下 编写customer.conf文件

```conf
server {
    listen 80;
    access_log off;

    location / {
        proxy_pass http://app:8083;
    }
   
}
```

5. 在~/docker-compose 目录下 使用docker-compose 启动容器

```shell
docker-compose up
```

6. 测试访问

```shell
http://192.168.0.204:88/hello
```